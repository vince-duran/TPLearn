<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Assessment Submissions - Complete Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-6xl mx-auto">
        <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg shadow-2xl p-8 mb-8">
            <h1 class="text-4xl font-bold mb-3">ğŸ”§ Fix Assessment Submissions Issue</h1>
            <p class="text-xl opacity-90">Step-by-step diagnostic and fix guide</p>
        </div>

        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-8">
            <h2 class="text-xl font-bold text-yellow-900 mb-2">ğŸ¯ Current Problem</h2>
            <p class="text-yellow-800">Clicking "Submissions" on attached assessment shows: <strong>"Error loading submissions. Please try again."</strong></p>
            <p class="text-yellow-700 mt-2">We need to check if:</p>
            <ul class="list-disc list-inside text-yellow-800 mt-2 ml-4">
                <li>There ARE any submissions in the database</li>
                <li>The API is working correctly</li>
                <li>The correct assessment ID is being passed</li>
            </ul>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6 border-t-4 border-blue-500">
                <h3 class="text-xl font-bold text-blue-900 mb-4">Step 1: Diagnostic</h3>
                <p class="text-gray-700 mb-4">Check if submissions exist and what the actual data looks like</p>
                <a href="/TPLearn/debug_assessment_submission_issue.php" 
                   class="block w-full bg-blue-600 text-white text-center py-3 rounded-lg font-bold hover:bg-blue-700 mb-2">
                    ğŸ” Run Diagnostic
                </a>
                <a href="/TPLearn/api/check_all_assessment_submissions.php" 
                   target="_blank"
                   class="block w-full bg-blue-500 text-white text-center py-2 rounded-lg text-sm hover:bg-blue-600">
                    View All Submissions (JSON)
                </a>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 border-t-4 border-green-500">
                <h3 class="text-xl font-bold text-green-900 mb-4">Step 2: Create Test Data</h3>
                <p class="text-gray-700 mb-4">If no submissions exist, create test submissions</p>
                <a href="/TPLearn/create_test_assessment_submissions.php" 
                   class="block w-full bg-green-600 text-white text-center py-3 rounded-lg font-bold hover:bg-green-700">
                    â• Create Test Submissions
                </a>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 border-t-4 border-purple-500">
                <h3 class="text-xl font-bold text-purple-900 mb-4">Step 3: Test UI</h3>
                <p class="text-gray-700 mb-4">Go to tutor stream and click Submissions button</p>
                <a href="/TPLearn/dashboards/tutor/tutor-program-stream.php?program_id=32&program=New+Prog" 
                   class="block w-full bg-purple-600 text-white text-center py-3 rounded-lg font-bold hover:bg-purple-700">
                    ğŸ§ª Test in Tutor Stream
                </a>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">ğŸ“Š What to Check</h2>
            
            <div class="space-y-6">
                <div class="border-l-4 border-blue-500 bg-blue-50 p-4">
                    <h3 class="font-bold text-blue-900 mb-2">1. Check Console Logs (F12)</h3>
                    <p class="text-sm text-blue-800 mb-2">When you click "Submissions", you should see:</p>
                    <pre class="bg-blue-900 text-blue-100 p-3 rounded text-xs overflow-x-auto">
ğŸ” Loading submissions for material: [assessment_id] Context: assessment
ğŸ“¡ Assessment API: /TPLearn/api/get-assessment-submissions.php?material_id=[id]
âœ… Assessment API HTTP Status: 200
ğŸ“„ Raw Response: {"success":true,...}
ğŸ“¦ Parsed Assessment API Response: {...}
âœ… Using assessment data</pre>
                    <p class="text-sm text-blue-800 mt-2">âŒ If you see errors, note what they say</p>
                </div>

                <div class="border-l-4 border-green-500 bg-green-50 p-4">
                    <h3 class="font-bold text-green-900 mb-2">2. Check API Response</h3>
                    <p class="text-sm text-green-800 mb-2">Click the diagnostic link above to see:</p>
                    <ul class="list-disc list-inside text-sm text-green-800 ml-4">
                        <li>Is the material found? âœ…/âŒ</li>
                        <li>Are there attached assessments? âœ…/âŒ</li>
                        <li>Are there submissions for that assessment? âœ…/âŒ</li>
                        <li>What is the assessment ID being used?</li>
                    </ul>
                </div>

                <div class="border-l-4 border-purple-500 bg-purple-50 p-4">
                    <h3 class="font-bold text-purple-900 mb-2">3. Test Scenarios</h3>
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b-2 border-purple-300">
                                <th class="text-left py-2">Scenario</th>
                                <th class="text-left py-2">Expected Result</th>
                            </tr>
                        </thead>
                        <tbody class="text-purple-800">
                            <tr class="border-b border-purple-200">
                                <td class="py-2">No submissions exist</td>
                                <td class="py-2">Modal opens, shows "No submissions found for this assessment"</td>
                            </tr>
                            <tr class="border-b border-purple-200">
                                <td class="py-2">Submissions exist</td>
                                <td class="py-2">Modal opens, shows table with submission data</td>
                            </tr>
                            <tr class="border-b border-purple-200">
                                <td class="py-2">API error</td>
                                <td class="py-2">Modal shows "Error loading assessment" (not "assignment"!)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="border-l-4 border-red-500 bg-red-50 p-4">
                    <h3 class="font-bold text-red-900 mb-2">4. Common Issues</h3>
                    <div class="space-y-2 text-sm text-red-800">
                        <div>
                            <strong>âŒ "Assessment not found or is not an assessment type"</strong>
                            <p class="ml-4">â†’ The ID being passed is not a valid assessment ID</p>
                            <p class="ml-4">â†’ Check that viewSubmissions() is receiving assessment.assessment_id correctly</p>
                        </div>
                        <div>
                            <strong>âŒ "Error loading assignment" (says "assignment" not "assessment")</strong>
                            <p class="ml-4">â†’ Context is not being set correctly</p>
                            <p class="ml-4">â†’ Should be fixed by our context priority code</p>
                        </div>
                        <div>
                            <strong>âœ… "No submissions found for this assessment"</strong>
                            <p class="ml-4">â†’ This is CORRECT! It means API works, just no data yet</p>
                            <p class="ml-4">â†’ Create test submissions using Step 2 above</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-gray-800 text-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold mb-4">ğŸ” Manual API Test</h2>
            <p class="mb-4">Open browser console (F12) and paste this:</p>
            <pre class="bg-gray-900 p-4 rounded overflow-x-auto text-sm">
// Replace [ASSESSMENT_ID] with actual assessment ID from diagnostic
fetch('/TPLearn/api/get-assessment-submissions.php?material_id=[ASSESSMENT_ID]')
  .then(r => r.json())
  .then(data => {
    console.log('API Response:', data);
    if (data.success) {
      console.log('âœ… API works!');
      console.log('Submissions:', data.submissions.length);
      console.log('Statistics:', data.statistics);
    } else {
      console.error('âŒ API Error:', data.error);
    }
  })
  .catch(err => console.error('Network Error:', err));</pre>
        </div>

        <div class="bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg shadow-lg p-8 text-center">
            <h2 class="text-3xl font-bold mb-4">ğŸ¯ Expected Outcome</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                <div class="bg-white bg-opacity-20 rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-2">If Submissions Exist:</h3>
                    <p class="text-lg">Modal opens â†’ Shows submission table with student names, grades, dates</p>
                </div>
                <div class="bg-white bg-opacity-20 rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-2">If No Submissions:</h3>
                    <p class="text-lg">Modal opens â†’ Shows "No submissions found for this <strong>assessment</strong>"</p>
                </div>
            </div>
        </div>

        <div class="text-center mt-8 text-gray-600">
            <p class="text-sm">Press F12 in browser to open Developer Console</p>
            <p class="text-xs mt-2">All console logs start with emoji icons: ğŸ” ğŸ“¡ âœ… âŒ ğŸ“¦</p>
        </div>
    </div>

    <script>
        console.log('%cğŸ”§ Assessment Submissions Debug Tool Loaded', 'color: purple; font-size: 16px; font-weight: bold');
        console.log('%cUse this console to test API calls manually', 'color: blue; font-size: 12px');
        
        // Helper function for quick testing
        window.testAssessmentAPI = function(assessmentId) {
            console.log(`%cğŸ§ª Testing API for assessment ID: ${assessmentId}`, 'color: green; font-weight: bold');
            
            fetch(`/TPLearn/api/get-assessment-submissions.php?material_id=${assessmentId}`)
                .then(r => {
                    console.log('HTTP Status:', r.status);
                    return r.json();
                })
                .then(data => {
                    console.log('API Response:', data);
                    if (data.success) {
                        console.log('%câœ… API Success!', 'color: green; font-weight: bold');
                        console.log('Assessment:', data.assessment);
                        console.log('Submissions:', data.submissions);
                        console.log('Statistics:', data.statistics);
                    } else {
                        console.error('%câŒ API Error:', 'color: red; font-weight: bold', data.error);
                    }
                })
                .catch(err => {
                    console.error('%câŒ Network Error:', 'color: red; font-weight: bold', err);
                });
        };
        
        console.log('%cTo test: testAssessmentAPI(YOUR_ASSESSMENT_ID)', 'color: blue; font-style: italic');
    </script>
</body>
</html>
